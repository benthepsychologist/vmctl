# Workstation Containers - Life + Dev Zones
#
# Trust gradient: agent < life < dev
# - life: Operator zone for supervised LLM tooling (you're actively watching)
# - dev: Builder zone for changing system capabilities
#
# Both zones share /workspace and can access agent app area for review/ops.

services:
  life:
    build:
      context: .
      dockerfile: Dockerfile.life
    image: workstation-life:latest
    container_name: life
    hostname: life
    ports:
      - "127.0.0.1:8080:8080"   # code-server (localhost-only by default)
    volumes:
      # Shared workspace - visible to both life and dev
      - workspace:/workspace
      # Agent app area access (full access like dev - life is operator zone)
      - agent-state:/agent/state
      - agent-outbox:/agent/outbox
      # Agent app code - read-only so changes go through dev
      - agent-repo:/agent/repo:ro
    environment:
      - ZONE=life
      - TRUST_LEVEL=operator
    restart: unless-stopped
    networks:
      - workstation

  dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    image: workstation-dev:latest
    container_name: dev
    hostname: dev
    ports:
      - "127.0.0.1:8081:8080"   # code-server (localhost-only by default)
    volumes:
      # Shared workspace - visible to both life and dev
      - workspace:/workspace
      # Agent app area access (full access for system changes)
      - agent-state:/agent/state
      - agent-outbox:/agent/outbox
      - agent-repo:/agent/repo
    environment:
      - ZONE=dev
      - TRUST_LEVEL=builder
    restart: unless-stopped
    networks:
      - workstation

networks:
  workstation:
    driver: bridge

volumes:
  # Shared workspace accessible to life and dev containers
  workspace:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${WORKSPACE_HOST_DIR:-/workspace}

  # Agent app area volumes - isolated from agent's /workspace access
  # These bind to the openclaw-gateway agent directory structure
  agent-state:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${AGENT_HOST_DIR:-/srv/vmctl/agent/openclaw-gateway}/state

  agent-outbox:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${AGENT_HOST_DIR:-/srv/vmctl/agent/openclaw-gateway}/outbox

  agent-repo:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${AGENT_HOST_DIR:-/srv/vmctl/agent/openclaw-gateway}/repo
