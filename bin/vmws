#!/bin/bash
# VM Workstation Manager CLI
# Manages self-hosted development VMs as Cloud Workstation replacements

set -e

VERSION="1.0.0"
CONFIG_FILE="${HOME}/.vmws/config"

# Default configuration
DEFAULT_VM_NAME="dev-workstation"
DEFAULT_ZONE="us-central1-a"
DEFAULT_PROJECT=""

# Load configuration
load_config() {
    if [ -f "$CONFIG_FILE" ]; then
        source "$CONFIG_FILE"
    fi
    VM_NAME="${VM_NAME:-$DEFAULT_VM_NAME}"
    ZONE="${ZONE:-$DEFAULT_ZONE}"
    PROJECT="${PROJECT:-$(gcloud config get-value project 2>/dev/null)}"
}

# Save configuration
save_config() {
    mkdir -p "$(dirname "$CONFIG_FILE")"
    cat > "$CONFIG_FILE" <<EOF
VM_NAME="$VM_NAME"
ZONE="$ZONE"
PROJECT="$PROJECT"
WORKSTATION_DISK="$WORKSTATION_DISK"
REGION="$REGION"
EOF
}

# Colors
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

show_help() {
    cat <<EOF
VM Workstation Manager v${VERSION}

Usage: vmws <command> [options]

Commands:
  create              Create a new development VM from workstation snapshot
  init-fresh          Create a new development VM from scratch (no workstation needed)
  start               Start the VM if stopped
  stop                Stop the VM
  connect             Connect to VM via SSH
  tunnel              Start IAP tunnel to code-server
  status              Show VM status
  delete              Delete the VM and all resources
  config              Configure VM name, zone, and project
  ssh                 SSH into the VM
  logs                View auto-shutdown logs

  install             Install vmws on local machine (Mac/Linux)

Options:
  -h, --help          Show this help message
  -v, --version       Show version

Examples:
  vmws create         # Create new dev VM from workstation
  vmws init-fresh     # Create new dev VM from scratch (standalone)
  vmws start          # Start stopped VM
  vmws connect        # SSH into VM
  vmws tunnel         # Open tunnel to code-server (port 8080)
  vmws status         # Check if VM is running
  vmws stop           # Stop VM to save money
  vmws delete         # Delete everything

Configuration:
  Config file: ~/.vmws/config

  Set defaults:
    vmws config --vm-name my-dev-vm --zone us-central1-a

Cost Savings:
  Cloud Workstation:  \$150/month
  Self-managed VM:    \$26-59/month
  Savings:            \$91-124/month (61-83%)

For more info: https://github.com/yourusername/vm-workstation-manager
EOF
}

check_vm_exists() {
    gcloud compute instances describe "$VM_NAME" --zone="$ZONE" --project="$PROJECT" &>/dev/null
}

get_vm_status() {
    if ! check_vm_exists; then
        echo "DOES_NOT_EXIST"
        return
    fi
    gcloud compute instances describe "$VM_NAME" --zone="$ZONE" --project="$PROJECT" --format="value(status)" 2>/dev/null || echo "UNKNOWN"
}

cmd_create() {
    echo -e "${YELLOW}Creating development VM from workstation snapshot...${NC}"
    echo ""

    # Check if VM already exists
    if check_vm_exists; then
        echo -e "${RED}Error: VM '$VM_NAME' already exists${NC}"
        echo "To delete it first: vmws delete"
        exit 1
    fi

    # Check if workstation disk is configured
    if [ -z "$WORKSTATION_DISK" ]; then
        echo -e "${RED}Error: Workstation disk not configured${NC}"
        echo ""
        echo "First, find your workstation disk name:"
        echo "  gcloud compute disks list --filter='name~workstations'"
        echo ""
        echo "Then configure it:"
        echo "  vmws config --workstation-disk <disk-name> --region <region>"
        echo ""
        echo "Or to create a fresh VM without a workstation:"
        echo "  vmws init-fresh"
        exit 1
    fi

    # Configuration
    MACHINE_TYPE="${MACHINE_TYPE:-e2-standard-2}"
    DISK_SIZE="${DISK_SIZE:-200GB}"
    BOOT_DISK_SIZE="${BOOT_DISK_SIZE:-50GB}"
    REGION="${REGION:-$(echo $ZONE | sed 's/-[a-z]$//')}"  # Derive region from zone if not set

    echo "Configuration:"
    echo "  Workstation Disk: $WORKSTATION_DISK"
    echo "  Region: $REGION"
    echo "  VM Name: $VM_NAME"
    echo "  Zone: $ZONE"
    echo "  Machine Type: $MACHINE_TYPE"
    echo ""

    read -p "Continue? (yes/no): " -r
    if [[ ! $REPLY =~ ^[Yy][Ee][Ss]$ ]]; then
        echo "Cancelled"
        exit 0
    fi

    echo ""
    echo "üîÑ Creating snapshot from workstation disk..."
    SNAPSHOT_NAME="workstation-snapshot-$(date +%Y%m%d-%H%M%S)"

    gcloud compute disks snapshot "$WORKSTATION_DISK" \
        --snapshot-names="$SNAPSHOT_NAME" \
        --region="$REGION" \
        --storage-location="$REGION" \
        --project="$PROJECT"

    echo "‚úÖ Snapshot created: $SNAPSHOT_NAME"
    echo ""
    echo "üíæ Creating new ${DISK_SIZE} disk from snapshot..."

    gcloud compute disks create "${VM_NAME}-disk" \
        --source-snapshot="$SNAPSHOT_NAME" \
        --size="$DISK_SIZE" \
        --type=pd-standard \
        --zone="$ZONE" \
        --project="$PROJECT"

    echo "‚úÖ Disk created: ${VM_NAME}-disk"
    echo ""

    # Get the script directory
    # Try to find the repo directory with scripts
    if [ -d "$(dirname "${BASH_SOURCE[0]}")/../scripts" ]; then
        # Running from repo
        SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
    elif [ -d "$HOME/vm-workstation-manager/scripts" ]; then
        # Installed, look in home
        SCRIPT_DIR="$HOME/vm-workstation-manager"
    elif [ -d "$(pwd)/vm-workstation-manager/scripts" ]; then
        # In parent of repo
        SCRIPT_DIR="$(pwd)/vm-workstation-manager"
    else
        echo -e "${RED}Error: Cannot find vm-workstation-manager scripts directory${NC}"
        echo "Make sure you have the repo cloned at: $HOME/vm-workstation-manager"
        exit 1
    fi

    echo "üñ•Ô∏è  Creating VM instance with data disk..."

    gcloud compute instances create "$VM_NAME" \
        --machine-type="$MACHINE_TYPE" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --image-family=debian-12 \
        --image-project=debian-cloud \
        --boot-disk-size="$BOOT_DISK_SIZE" \
        --boot-disk-type=pd-standard \
        --disk=name="${VM_NAME}-disk",mode=rw \
        --scopes=cloud-platform \
        --metadata=enable-oslogin=TRUE \
        --metadata-from-file=startup-script="${SCRIPT_DIR}/scripts/vm-startup-script.sh"

    echo "‚úÖ VM created: $VM_NAME"
    echo ""
    echo "üì° Waiting for VM to be ready..."
    sleep 15

    # Wait for SSH
    echo "Waiting for SSH..."
    for i in {1..30}; do
        if gcloud compute ssh "$VM_NAME" --zone="$ZONE" --project="$PROJECT" --tunnel-through-iap --command="echo ready" &>/dev/null; then
            echo "‚úÖ SSH ready"
            break
        fi
        sleep 2
    done

    echo ""
    echo "üîß Installing development environment..."
    echo "This will take 3-5 minutes (Docker, code-server, neovim)..."
    echo ""

    # Copy setup script to VM
    gcloud compute scp "${SCRIPT_DIR}/scripts/setup-vm-environment.sh" \
        "$VM_NAME:/tmp/setup-vm-environment.sh" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --tunnel-through-iap

    # Run setup
    gcloud compute ssh "$VM_NAME" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --tunnel-through-iap \
        --command="bash /tmp/setup-vm-environment.sh"

    echo ""
    echo "‚è∞ Installing auto-shutdown (2hr idle timeout)..."

    # Copy auto-shutdown scripts
    gcloud compute scp "${SCRIPT_DIR}/scripts/vm-auto-shutdown.sh" \
        "$VM_NAME:/tmp/vm-auto-shutdown.sh" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --tunnel-through-iap

    gcloud compute scp "${SCRIPT_DIR}/scripts/install-auto-shutdown.sh" \
        "$VM_NAME:/tmp/install-auto-shutdown.sh" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --tunnel-through-iap

    # Install auto-shutdown
    gcloud compute ssh "$VM_NAME" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --tunnel-through-iap \
        --command="bash /tmp/install-auto-shutdown.sh"

    echo ""
    echo -e "${GREEN}‚úÖ VM created successfully from workstation snapshot!${NC}"
    echo ""
    echo "Your development VM is ready:"
    echo "  Name: $VM_NAME"
    echo "  Zone: $ZONE"
    echo "  Data: Copied from $WORKSTATION_DISK"
    echo ""
    echo "Next steps:"
    echo "  1. Start tunnel: vmws tunnel"
    echo "  2. Open browser: http://localhost:8080"
    echo "  3. Your files are at: /mnt/home/user/"
    echo ""
    echo "Auto-shutdown: VM will stop after 2hr idle (saves money)"
    echo ""
}

cmd_init_fresh() {
    echo -e "${YELLOW}Creating fresh development VM (no workstation required)...${NC}"
    echo ""

    # Check if VM already exists
    if check_vm_exists; then
        echo -e "${RED}Error: VM '$VM_NAME' already exists${NC}"
        echo "To delete it first: vmws delete"
        exit 1
    fi

    # Configuration
    MACHINE_TYPE="${MACHINE_TYPE:-e2-standard-2}"
    DISK_SIZE="${DISK_SIZE:-200GB}"
    BOOT_DISK_SIZE="${BOOT_DISK_SIZE:-50GB}"

    echo "Configuration:"
    echo "  VM Name: $VM_NAME"
    echo "  Zone: $ZONE"
    echo "  Machine Type: $MACHINE_TYPE (2 vCPU, 8GB RAM)"
    echo "  Boot Disk: $BOOT_DISK_SIZE"
    echo "  Data Disk: $DISK_SIZE"
    echo ""

    read -p "Continue? (yes/no): " -r
    if [[ ! $REPLY =~ ^[Yy][Ee][Ss]$ ]]; then
        echo "Cancelled"
        exit 0
    fi

    echo ""
    echo "üñ•Ô∏è  Creating VM instance..."

    # Create data disk first
    echo "üíæ Creating data disk..."
    gcloud compute disks create "${VM_NAME}-disk" \
        --size="$DISK_SIZE" \
        --type=pd-standard \
        --zone="$ZONE" \
        --project="$PROJECT"

    echo "‚úÖ Data disk created: ${VM_NAME}-disk"
    echo ""

    # Get the script directory
    # Try to find the repo directory with scripts
    if [ -d "$(dirname "${BASH_SOURCE[0]}")/../scripts" ]; then
        # Running from repo
        SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
    elif [ -d "$HOME/vm-workstation-manager/scripts" ]; then
        # Installed, look in home
        SCRIPT_DIR="$HOME/vm-workstation-manager"
    elif [ -d "$(pwd)/vm-workstation-manager/scripts" ]; then
        # In parent of repo
        SCRIPT_DIR="$(pwd)/vm-workstation-manager"
    else
        echo -e "${RED}Error: Cannot find vm-workstation-manager scripts directory${NC}"
        echo "Make sure you have the repo cloned at: $HOME/vm-workstation-manager"
        exit 1
    fi

    # Create VM
    echo "üñ•Ô∏è  Creating VM..."
    gcloud compute instances create "$VM_NAME" \
        --machine-type="$MACHINE_TYPE" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --image-family=debian-12 \
        --image-project=debian-cloud \
        --boot-disk-size="$BOOT_DISK_SIZE" \
        --boot-disk-type=pd-standard \
        --disk=name="${VM_NAME}-disk",mode=rw \
        --scopes=cloud-platform \
        --metadata=enable-oslogin=TRUE \
        --metadata-from-file=startup-script="${SCRIPT_DIR}/scripts/vm-startup-script.sh"

    echo "‚úÖ VM created: $VM_NAME"
    echo ""
    echo "üì° Waiting for VM to be ready..."
    sleep 15

    # Wait for SSH
    echo "Waiting for SSH..."
    for i in {1..30}; do
        if gcloud compute ssh "$VM_NAME" --zone="$ZONE" --project="$PROJECT" --tunnel-through-iap --command="echo ready" &>/dev/null; then
            echo "‚úÖ SSH ready"
            break
        fi
        sleep 2
    done

    echo ""
    echo "üîß Installing development environment..."
    echo "This will take 3-5 minutes (Docker, code-server, neovim)..."
    echo ""

    # Copy setup script to VM
    gcloud compute scp "${SCRIPT_DIR}/scripts/setup-vm-environment.sh" \
        "$VM_NAME:/tmp/setup-vm-environment.sh" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --tunnel-through-iap

    # Run setup
    gcloud compute ssh "$VM_NAME" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --tunnel-through-iap \
        --command="bash /tmp/setup-vm-environment.sh"

    echo ""
    echo "‚è∞ Installing auto-shutdown (2hr idle timeout)..."

    # Copy auto-shutdown scripts
    gcloud compute scp "${SCRIPT_DIR}/scripts/vm-auto-shutdown.sh" \
        "$VM_NAME:/tmp/vm-auto-shutdown.sh" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --tunnel-through-iap

    gcloud compute scp "${SCRIPT_DIR}/scripts/install-auto-shutdown.sh" \
        "$VM_NAME:/tmp/install-auto-shutdown.sh" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --tunnel-through-iap

    # Install auto-shutdown
    gcloud compute ssh "$VM_NAME" \
        --zone="$ZONE" \
        --project="$PROJECT" \
        --tunnel-through-iap \
        --command="bash /tmp/install-auto-shutdown.sh"

    echo ""
    echo -e "${GREEN}‚úÖ VM created successfully!${NC}"
    echo ""
    echo "Your development VM is ready:"
    echo "  Name: $VM_NAME"
    echo "  Zone: $ZONE"
    echo "  Machine: $MACHINE_TYPE"
    echo ""
    echo "Next steps:"
    echo "  1. Start tunnel: vmws tunnel"
    echo "  2. Open browser: http://localhost:8080"
    echo "  3. Start coding!"
    echo ""
    echo "Your files will be at: /mnt/home/<your-user>/"
    echo ""
    echo "Auto-shutdown: VM will stop after 2hr idle (saves money)"
    echo ""
}

cmd_start() {
    echo -e "${YELLOW}Starting VM: $VM_NAME${NC}"

    STATUS=$(get_vm_status)

    if [ "$STATUS" = "DOES_NOT_EXIST" ]; then
        echo -e "${RED}Error: VM does not exist${NC}"
        echo "Run: vmws create"
        exit 1
    fi

    if [ "$STATUS" = "RUNNING" ]; then
        echo -e "${GREEN}‚úì VM is already running${NC}"
        return
    fi

    echo "Starting VM..."
    gcloud compute instances start "$VM_NAME" --zone="$ZONE" --project="$PROJECT"

    echo "Waiting for VM to be ready..."
    sleep 10

    for i in {1..30}; do
        if gcloud compute ssh "$VM_NAME" --zone="$ZONE" --project="$PROJECT" --tunnel-through-iap --command="echo ready" &>/dev/null; then
            echo -e "${GREEN}‚úì VM is ready!${NC}"
            echo ""
            echo "To access code-server: vmws tunnel"
            echo "To SSH: vmws connect"
            return
        fi
        sleep 2
    done

    echo -e "${RED}Warning: VM started but SSH not ready yet${NC}"
}

cmd_stop() {
    echo -e "${YELLOW}Stopping VM: $VM_NAME${NC}"

    STATUS=$(get_vm_status)

    if [ "$STATUS" = "DOES_NOT_EXIST" ]; then
        echo -e "${RED}Error: VM does not exist${NC}"
        exit 1
    fi

    if [ "$STATUS" = "TERMINATED" ]; then
        echo -e "${GREEN}‚úì VM is already stopped${NC}"
        return
    fi

    gcloud compute instances stop "$VM_NAME" --zone="$ZONE" --project="$PROJECT"
    echo -e "${GREEN}‚úì VM stopped${NC}"
}

cmd_status() {
    STATUS=$(get_vm_status)

    echo "VM Status Report"
    echo "================"
    echo "Name:    $VM_NAME"
    echo "Zone:    $ZONE"
    echo "Project: $PROJECT"
    echo ""

    case "$STATUS" in
        "RUNNING")
            echo -e "Status:  ${GREEN}RUNNING ‚úì${NC}"

            # Get IP
            IP=$(gcloud compute instances describe "$VM_NAME" --zone="$ZONE" --project="$PROJECT" --format="value(networkInterfaces[0].accessConfigs[0].natIP)" 2>/dev/null)
            echo "IP:      $IP"
            echo ""
            echo "Access:"
            echo "  SSH:         vmws connect"
            echo "  Code-server: vmws tunnel (then visit http://localhost:8080)"
            ;;
        "TERMINATED")
            echo -e "Status:  ${YELLOW}STOPPED${NC}"
            echo ""
            echo "To start: vmws start"
            ;;
        "DOES_NOT_EXIST")
            echo -e "Status:  ${RED}DOES NOT EXIST${NC}"
            echo ""
            echo "To create: vmws create (from workstation)"
            ;;
        *)
            echo "Status:  $STATUS"
            ;;
    esac
}

cmd_connect() {
    STATUS=$(get_vm_status)

    if [ "$STATUS" != "RUNNING" ]; then
        echo -e "${RED}Error: VM is not running (status: $STATUS)${NC}"
        echo "Run: vmws start"
        exit 1
    fi

    echo -e "${GREEN}Connecting to VM...${NC}"
    gcloud compute ssh "$VM_NAME" --zone="$ZONE" --project="$PROJECT" --tunnel-through-iap
}

cmd_tunnel() {
    STATUS=$(get_vm_status)

    if [ "$STATUS" != "RUNNING" ]; then
        echo -e "${RED}Error: VM is not running (status: $STATUS)${NC}"
        echo "Run: vmws start"
        exit 1
    fi

    echo -e "${GREEN}Starting IAP tunnel to code-server...${NC}"
    echo ""
    echo "Visit: ${BLUE}http://localhost:8080${NC}"
    echo "Press Ctrl+C to stop the tunnel"
    echo ""

    gcloud compute ssh "$VM_NAME" --zone="$ZONE" --project="$PROJECT" --tunnel-through-iap -- -L 8080:localhost:8080 -N
}

cmd_ssh() {
    cmd_connect
}

cmd_delete() {
    echo -e "${YELLOW}Deleting VM and all resources${NC}"
    echo ""

    if ! check_vm_exists; then
        echo -e "${RED}VM does not exist${NC}"
        exit 1
    fi

    read -p "Are you sure you want to delete $VM_NAME? (yes/no): " -r
    if [[ ! $REPLY =~ ^[Yy][Ee][Ss]$ ]]; then
        echo "Cancelled"
        exit 0
    fi

    # Check if we're on workstation with cleanup script
    if [ -f "/home/user/cleanup-test-vm.sh" ]; then
        bash /home/user/cleanup-test-vm.sh
    else
        # Manual cleanup
        echo "Deleting VM..."
        gcloud compute instances delete "$VM_NAME" --zone="$ZONE" --project="$PROJECT" --quiet

        echo "Deleting disk..."
        gcloud compute disks delete "${VM_NAME}-disk" --zone="$ZONE" --project="$PROJECT" --quiet 2>/dev/null || true

        echo "Deleting snapshots..."
        gcloud compute snapshots list --filter="name~$VM_NAME" --format="value(name)" | while read snapshot; do
            gcloud compute snapshots delete "$snapshot" --quiet
        done
    fi

    echo -e "${GREEN}‚úì Deleted${NC}"
}

cmd_config() {
    mkdir -p "$(dirname "$CONFIG_FILE")"

    if [ "$#" -eq 0 ]; then
        # Interactive configuration
        echo "Current Configuration:"
        echo "  VM Name:          $VM_NAME"
        echo "  Zone:             $ZONE"
        echo "  Project:          $PROJECT"
        echo "  Workstation Disk: ${WORKSTATION_DISK:-not set}"
        echo "  Region:           ${REGION:-not set}"
        echo ""

        read -p "VM Name [$VM_NAME]: " new_name
        read -p "Zone [$ZONE]: " new_zone
        read -p "Project [$PROJECT]: " new_project
        read -p "Workstation Disk [${WORKSTATION_DISK}]: " new_disk
        read -p "Region [${REGION}]: " new_region

        VM_NAME="${new_name:-$VM_NAME}"
        ZONE="${new_zone:-$ZONE}"
        PROJECT="${new_project:-$PROJECT}"
        WORKSTATION_DISK="${new_disk:-$WORKSTATION_DISK}"
        REGION="${new_region:-$REGION}"

        save_config
        echo -e "${GREEN}‚úì Configuration saved${NC}"
    else
        # Parse command line options
        while [[ $# -gt 0 ]]; do
            case $1 in
                --vm-name)
                    VM_NAME="$2"
                    shift 2
                    ;;
                --zone)
                    ZONE="$2"
                    shift 2
                    ;;
                --project)
                    PROJECT="$2"
                    shift 2
                    ;;
                --workstation-disk)
                    WORKSTATION_DISK="$2"
                    shift 2
                    ;;
                --region)
                    REGION="$2"
                    shift 2
                    ;;
                *)
                    echo "Unknown option: $1"
                    exit 1
                    ;;
            esac
        done
        save_config
        echo -e "${GREEN}‚úì Configuration saved${NC}"
    fi
}

cmd_logs() {
    if ! check_vm_exists; then
        echo -e "${RED}VM does not exist${NC}"
        exit 1
    fi

    echo "Auto-shutdown logs:"
    echo "==================="
    gcloud compute ssh "$VM_NAME" --zone="$ZONE" --project="$PROJECT" --tunnel-through-iap --command="sudo journalctl -u vm-auto-shutdown -n 50 --no-pager"
}

cmd_install() {
    echo "Installing vmws locally..."

    # Determine install location
    if [ -w "/usr/local/bin" ]; then
        INSTALL_DIR="/usr/local/bin"
    else
        INSTALL_DIR="$HOME/.local/bin"
        mkdir -p "$INSTALL_DIR"
    fi

    # Copy this script
    cp "$0" "$INSTALL_DIR/vmws"
    chmod +x "$INSTALL_DIR/vmws"

    echo -e "${GREEN}‚úì Installed to $INSTALL_DIR/vmws${NC}"

    if [[ ":$PATH:" != *":$INSTALL_DIR:"* ]]; then
        echo ""
        echo -e "${YELLOW}Note: Add $INSTALL_DIR to your PATH${NC}"
        echo "Add this to your ~/.bashrc or ~/.zshrc:"
        echo "  export PATH=\"\$PATH:$INSTALL_DIR\""
    fi
}

# Main command dispatcher
main() {
    load_config

    if [ $# -eq 0 ]; then
        show_help
        exit 0
    fi

    case "$1" in
        create)
            cmd_create
            ;;
        init-fresh)
            cmd_init_fresh
            ;;
        start)
            cmd_start
            ;;
        stop)
            cmd_stop
            ;;
        status)
            cmd_status
            ;;
        connect|ssh)
            cmd_connect
            ;;
        tunnel)
            cmd_tunnel
            ;;
        delete)
            cmd_delete
            ;;
        config)
            shift
            cmd_config "$@"
            ;;
        logs)
            cmd_logs
            ;;
        install)
            cmd_install
            ;;
        -h|--help|help)
            show_help
            ;;
        -v|--version|version)
            echo "vmws version $VERSION"
            ;;
        *)
            echo -e "${RED}Unknown command: $1${NC}"
            echo ""
            show_help
            exit 1
            ;;
    esac
}

main "$@"
